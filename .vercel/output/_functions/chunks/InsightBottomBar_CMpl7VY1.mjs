import { e as createAstro, f as createComponent, r as renderTemplate, h as addAttribute, m as maybeRenderHead } from "./astro/server_C4zwJFjj.mjs";
import "piccolore";
import "clsx";
var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro("http://localhost:4322");
const $$InsightBottomBar = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$InsightBottomBar;
  const { active = "prompt", showActions = false } = Astro2.props;
  const u = new URL(Astro2.request.url);
  const keep = [
    "window_start_date",
    "anchor_date",
    "selected_date",
    "selected_dates",
    "saved_item_id"
  ];
  function withKeptParams(pathname) {
    const to = new URL(pathname, u.origin);
    for (const k of keep) {
      const v = u.searchParams.get(k);
      if (v && v.trim()) to.searchParams.set(k, v);
    }
    return to.pathname + (to.search ? to.search : "");
  }
  function withoutKeptParams(pathname) {
    const to = new URL(pathname, u.origin);
    return to.pathname;
  }
  const hrefPrompt = withKeptParams("/app/insightevent/prompt");
  const hrefMonth = withKeptParams("/app/insightevent/month");
  const hrefDays = withoutKeptParams("/app/insightevent/days");
  return renderTemplate(_a || (_a = __template(["", '<div class="ms-bottombar" role="navigation" aria-label="Navigation Insight Event"> ', ' <div class="ms-bottombar-nav"> <a', "", ' aria-label="Prompt"', '> <div class="ms-bottombar-ico" aria-hidden="true"> <svg width="22" height="22" viewBox="0 0 24 24" fill="none"> <path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> </svg> </div> <div class="ms-bottombar-label">PROMPT</div> </a> <a', "", ' aria-label="Mois"', '> <div class="ms-bottombar-ico" aria-hidden="true"> <svg width="22" height="22" viewBox="0 0 24 24" fill="none"> <path d="M7 2v3M17 2v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> <path d="M3.5 9h17" stroke="currentColor" stroke-width="1.8"></path> <path d="M6 5h12a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.8"></path> </svg> </div> <div class="ms-bottombar-label">MOIS</div> </a> <a', "", ' aria-label="Jours"', '> <div class="ms-bottombar-ico" aria-hidden="true"> <svg width="22" height="22" viewBox="0 0 24 24" fill="none"> <path d="M4 6h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> <path d="M4 12h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> <path d="M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> </svg> </div> <div class="ms-bottombar-label">JOURS</div> </a> </div> </div> <script>\n  (function () {\n    const saveBtn = document.getElementById("cta-save");\n    const addBtn = document.getElementById("cta-add-calendar");\n    const shareBtn = document.getElementById("cta-share");\n\n    if (!saveBtn && !addBtn && !shareBtn) return;\n\n    function getShareLink() {\n      const u = new URL(window.location.href);\n\n      const savedItemId = (u.searchParams.get("saved_item_id") || "").trim();\n      if (savedItemId) {\n        const out = new URL(u.origin + "/app/insightevent/days");\n        out.searchParams.set("saved_item_id", savedItemId);\n        return out.toString();\n      }\n\n      // Fallback (temporary): raw URL\n      // For MVP we will *prefer* forcing save before share (see shareChoice()).\n      return u.toString();\n    }\n\n    function getSelectedDateForCalendar() {\n      const u = new URL(window.location.href);\n\n      const selectedDate = (u.searchParams.get("selected_date") || "").trim();\n      if (selectedDate) return selectedDate;\n\n      const selectedDatesRaw = (u.searchParams.get("selected_dates") || "").trim();\n      if (selectedDatesRaw) {\n        const first = selectedDatesRaw.split(",").map(s => s.trim()).filter(Boolean)[0];\n        if (first) return first;\n      }\n      return "";\n    }\n\n    function ymdToUtcAllDayStamp(ymd) {\n      // Google Calendar expects YYYYMMDD for all-day dates\n      return String(ymd || "").trim().replace(/-/g, "");\n    }\n\n    function openGoogleCalendarAllDay(ymd, link) {\n      if (!ymd) return;\n\n      const dtStart = ymdToUtcAllDayStamp(ymd);\n\n      // End date is exclusive for all-day events → next day\n      const d = new Date(ymd + "T00:00:00Z");\n      if (Number.isNaN(d.getTime())) return;\n      d.setUTCDate(d.getUTCDate() + 1);\n\n      const y = d.getUTCFullYear();\n      const mo = String(d.getUTCMonth() + 1).padStart(2, "0");\n      const da = String(d.getUTCDate()).padStart(2, "0");\n      const dtEnd = `${y}${mo}${da}`;\n\n      const url = new URL("https://calendar.google.com/calendar/render");\n      url.searchParams.set("action", "TEMPLATE");\n      url.searchParams.set("text", "Choix de date – Muse Square");\n      url.searchParams.set("dates", `${dtStart}/${dtEnd}`);\n      url.searchParams.set("details", `Choix de date Muse Square.\\n${link}`);\n\n      window.open(url.toString(), "_blank", "noopener,noreferrer");\n    }\n\n    async function copyToClipboardOrFallback(text) {\n      if (navigator.clipboard && navigator.clipboard.writeText) {\n        try {\n          await navigator.clipboard.writeText(text);\n          alert("Lien copié.");\n          return true;\n        } catch (_) {}\n      }\n      window.prompt("Copiez ce lien :", text);\n      return false;\n    }\n\n    function openSaveModal() {\n      window.dispatchEvent(new CustomEvent("ms:open-save-modal"));\n    }\n\n    function addToCalendar() {\n      // No downloads: Google Calendar template URL\n      const ymd = getSelectedDateForCalendar();\n      if (!ymd) return;\n\n      const link = getShareLink();\n      openGoogleCalendarAllDay(ymd, link);\n    }\n\n    async function shareChoice() {\n      const u = new URL(window.location.href);\n      const savedItemId = (u.searchParams.get("saved_item_id") || "").trim();\n\n      // MVP: if not saved, force save first (fast + produces a stable link)\n      if (!savedItemId) {\n        openSaveModal();\n        return;\n      }\n\n      const link = getShareLink();\n\n      if (navigator.share) {\n        try {\n          await navigator.share({\n            title: "Muse Square – choix de date",\n            text: "Voici mon choix de date Muse Square :",\n            url: link,\n          });\n          return;\n        } catch (_) {}\n      }\n\n      await copyToClipboardOrFallback(link);\n    }\n\n    if (saveBtn) {\n      saveBtn.addEventListener("click", openSaveModal);\n    }\n    if (addBtn) addBtn.addEventListener("click", addToCalendar);\n    if (shareBtn) shareBtn.addEventListener("click", shareChoice);\n  })();\n<\/script>'], ["", '<div class="ms-bottombar" role="navigation" aria-label="Navigation Insight Event"> ', ' <div class="ms-bottombar-nav"> <a', "", ' aria-label="Prompt"', '> <div class="ms-bottombar-ico" aria-hidden="true"> <svg width="22" height="22" viewBox="0 0 24 24" fill="none"> <path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> </svg> </div> <div class="ms-bottombar-label">PROMPT</div> </a> <a', "", ' aria-label="Mois"', '> <div class="ms-bottombar-ico" aria-hidden="true"> <svg width="22" height="22" viewBox="0 0 24 24" fill="none"> <path d="M7 2v3M17 2v3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> <path d="M3.5 9h17" stroke="currentColor" stroke-width="1.8"></path> <path d="M6 5h12a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.8"></path> </svg> </div> <div class="ms-bottombar-label">MOIS</div> </a> <a', "", ' aria-label="Jours"', '> <div class="ms-bottombar-ico" aria-hidden="true"> <svg width="22" height="22" viewBox="0 0 24 24" fill="none"> <path d="M4 6h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> <path d="M4 12h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> <path d="M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path> </svg> </div> <div class="ms-bottombar-label">JOURS</div> </a> </div> </div> <script>\n  (function () {\n    const saveBtn = document.getElementById("cta-save");\n    const addBtn = document.getElementById("cta-add-calendar");\n    const shareBtn = document.getElementById("cta-share");\n\n    if (!saveBtn && !addBtn && !shareBtn) return;\n\n    function getShareLink() {\n      const u = new URL(window.location.href);\n\n      const savedItemId = (u.searchParams.get("saved_item_id") || "").trim();\n      if (savedItemId) {\n        const out = new URL(u.origin + "/app/insightevent/days");\n        out.searchParams.set("saved_item_id", savedItemId);\n        return out.toString();\n      }\n\n      // Fallback (temporary): raw URL\n      // For MVP we will *prefer* forcing save before share (see shareChoice()).\n      return u.toString();\n    }\n\n    function getSelectedDateForCalendar() {\n      const u = new URL(window.location.href);\n\n      const selectedDate = (u.searchParams.get("selected_date") || "").trim();\n      if (selectedDate) return selectedDate;\n\n      const selectedDatesRaw = (u.searchParams.get("selected_dates") || "").trim();\n      if (selectedDatesRaw) {\n        const first = selectedDatesRaw.split(",").map(s => s.trim()).filter(Boolean)[0];\n        if (first) return first;\n      }\n      return "";\n    }\n\n    function ymdToUtcAllDayStamp(ymd) {\n      // Google Calendar expects YYYYMMDD for all-day dates\n      return String(ymd || "").trim().replace(/-/g, "");\n    }\n\n    function openGoogleCalendarAllDay(ymd, link) {\n      if (!ymd) return;\n\n      const dtStart = ymdToUtcAllDayStamp(ymd);\n\n      // End date is exclusive for all-day events → next day\n      const d = new Date(ymd + "T00:00:00Z");\n      if (Number.isNaN(d.getTime())) return;\n      d.setUTCDate(d.getUTCDate() + 1);\n\n      const y = d.getUTCFullYear();\n      const mo = String(d.getUTCMonth() + 1).padStart(2, "0");\n      const da = String(d.getUTCDate()).padStart(2, "0");\n      const dtEnd = \\`\\${y}\\${mo}\\${da}\\`;\n\n      const url = new URL("https://calendar.google.com/calendar/render");\n      url.searchParams.set("action", "TEMPLATE");\n      url.searchParams.set("text", "Choix de date – Muse Square");\n      url.searchParams.set("dates", \\`\\${dtStart}/\\${dtEnd}\\`);\n      url.searchParams.set("details", \\`Choix de date Muse Square.\\\\n\\${link}\\`);\n\n      window.open(url.toString(), "_blank", "noopener,noreferrer");\n    }\n\n    async function copyToClipboardOrFallback(text) {\n      if (navigator.clipboard && navigator.clipboard.writeText) {\n        try {\n          await navigator.clipboard.writeText(text);\n          alert("Lien copié.");\n          return true;\n        } catch (_) {}\n      }\n      window.prompt("Copiez ce lien :", text);\n      return false;\n    }\n\n    function openSaveModal() {\n      window.dispatchEvent(new CustomEvent("ms:open-save-modal"));\n    }\n\n    function addToCalendar() {\n      // No downloads: Google Calendar template URL\n      const ymd = getSelectedDateForCalendar();\n      if (!ymd) return;\n\n      const link = getShareLink();\n      openGoogleCalendarAllDay(ymd, link);\n    }\n\n    async function shareChoice() {\n      const u = new URL(window.location.href);\n      const savedItemId = (u.searchParams.get("saved_item_id") || "").trim();\n\n      // MVP: if not saved, force save first (fast + produces a stable link)\n      if (!savedItemId) {\n        openSaveModal();\n        return;\n      }\n\n      const link = getShareLink();\n\n      if (navigator.share) {\n        try {\n          await navigator.share({\n            title: "Muse Square – choix de date",\n            text: "Voici mon choix de date Muse Square :",\n            url: link,\n          });\n          return;\n        } catch (_) {}\n      }\n\n      await copyToClipboardOrFallback(link);\n    }\n\n    if (saveBtn) {\n      saveBtn.addEventListener("click", openSaveModal);\n    }\n    if (addBtn) addBtn.addEventListener("click", addToCalendar);\n    if (shareBtn) shareBtn.addEventListener("click", shareChoice);\n  })();\n<\/script>'])), maybeRenderHead(), showActions && renderTemplate`<div class="ms-bottombar-actions"> <div class="ms-bottombar-actions-inner"> <button id="cta-save" type="button" class="ms-bottombar-btn ms-bottombar-btn--ghost">
Enregistrer
</button> <button id="cta-share" type="button" class="ms-bottombar-btn ms-bottombar-btn--primary">
Partager choix
</button> </div> </div>`, addAttribute(`ms-bottombar-item ${active === "prompt" ? "is-active" : ""}`, "class"), addAttribute(hrefPrompt, "href"), addAttribute(active === "prompt" ? "page" : void 0, "aria-current"), addAttribute(`ms-bottombar-item ${active === "month" ? "is-active" : ""}`, "class"), addAttribute(hrefMonth, "href"), addAttribute(active === "month" ? "page" : void 0, "aria-current"), addAttribute(`ms-bottombar-item ${active === "days" ? "is-active" : ""}`, "class"), addAttribute(hrefDays, "href"), addAttribute(active === "days" ? "page" : void 0, "aria-current"));
}, "/Users/julendeajuriaguerra/Documents/Muse_Square/Muse_Square_Website/muse-square/src/components/InsightBottomBar.astro", void 0);
export {
  $$InsightBottomBar as $
};
